
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Model the stellar I2 observations &#8212; pyodine</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Weight and combine the chunk velocities" href="velocities.html" />
    <link rel="prev" title="Create a deconvolved stellar template" href="template.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">pyodine</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  Quick start
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../overview.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../code_structure.html">
   Code structure
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../api.html">
   API
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Tutorial
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="preparation.html">
   Prepare the environment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="template.html">
   Create a deconvolved stellar template
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Model the stellar I2 observations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="velocities.html">
   Weight and combine the chunk velocities
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/tutorial/observation.ipynb.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#background">
   Background
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-the-code">
   Run the code
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#inspecting-the-fit-results-of-an-observation">
   Inspecting the fit results of an observation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-the-code-on-many-observations">
   Run the code on many observations
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="model-the-stellar-i2-observations">
<h1>Model the stellar I2 observations<a class="headerlink" href="#model-the-stellar-i2-observations" title="Permalink to this headline">¶</a></h1>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>If you’ve completed the last tutorial <a class="reference internal" href="template.html"><span class="doc std std-doc">and created a deconvolved stellar template</span></a>, we can now use that to model I2 observations of our star. This means: observations of the star conducted with the I2 cell in the light path, so that the stellar and I2 spectrum are both recorded together. The resulting spectrum <span class="math notranslate nohighlight">\(I_*(x)\)</span> can then be modelled by a combination of the deconvolved stellar template <span class="math notranslate nohighlight">\(T_*(\lambda)\)</span>, the I2 template <span class="math notranslate nohighlight">\(T_\mathrm{I2}(\lambda)\)</span>, a LSF model <span class="math notranslate nohighlight">\(L(x)\)</span>, and a continuum model <span class="math notranslate nohighlight">\(k(x)\)</span>:</p>
<div class="math notranslate nohighlight">
\[
    \hat{I}_*(x) = k(x) \cdot \Big[ T_\mathrm{I2}\big(\lambda(x)\big) \cdot T_*\big(\lambda(x) \cdot (1 + v/c)\big) \Big] * L(x)
\]</div>
<p>As you can see, the deconvolved stellar template is shifted in wavelength by a factor <span class="math notranslate nohighlight">\((1 + v/c)\)</span>, where <span class="math notranslate nohighlight">\(v\)</span> is the relative radial velocity between the observation and the template. So, in words: The I2 atlas gives us a measure to constrain the wavelength model and consequently detect the relative wavelength shift between observation and template.</p>
<p>Again, all this is done in chunks to reduce complexity.</p>
</div>
<div class="section" id="run-the-code">
<h2>Run the code<a class="headerlink" href="#run-the-code" title="Permalink to this headline">¶</a></h2>
<p>Again, first let’s set up the path and import the required packages:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Automatic reloading of imports</span>
<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;/home/paul/pyodine/&#39;</span><span class="p">)</span>  <span class="c1"># Put in the pyodine path on your machine here!</span>

<span class="kn">import</span> <span class="nn">pyodine</span>
<span class="kn">import</span> <span class="nn">pyodine_model_observations</span>       <span class="c1"># &lt;- the observation modelling routines</span>
</pre></div>
</div>
</div>
</div>
<p>And, as before, import the utilities module and the parameter input object (this time not <code class="docutils literal notranslate"><span class="pre">Template_Parameters</span></code>, but <code class="docutils literal notranslate"><span class="pre">Parameters</span></code>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">utilities_song</span> <span class="k">as</span> <span class="nn">utilities</span>

<span class="n">Pars</span> <span class="o">=</span> <span class="n">utilities</span><span class="o">.</span><span class="n">pyodine_parameters</span><span class="o">.</span><span class="n">Parameters</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Now we define the pathnames of the input data and output results: first the observation filenames, and for each single observation we need to specify the pathname of the deconvolved stellar template to use for it; in our case it’s always the same (as all observations are of the same star), but this structure allows also to model observations from different stars in the same go (useful e.g. when analyzing all observations of an observing night). Also we define plot directories and results filenames (now we save all in HDF5 - this takes up much less memory than when using <strong>dill</strong>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Observations to model</span>
<span class="n">obs_dir</span> <span class="o">=</span> <span class="s1">&#39;/home/paul/data_song/data_ext/sigdra_obs_tutorial/&#39;</span>
<span class="n">obs_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">obs_dir</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">obs_dir</span><span class="p">)]</span>
<span class="n">obs_files</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

<span class="c1"># Deconvolved stellar template to use</span>
<span class="n">temp_file</span> <span class="o">=</span> <span class="s1">&#39;/home/paul/data_song2/templates/temp_sigdra_2018-05-16.h5&#39;</span>
<span class="n">temp_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">temp_file</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs_files</span><span class="p">)</span>

<span class="c1"># Output directories for plots and output pathnames for modelling results</span>
<span class="n">plot_dir_parent</span> <span class="o">=</span> <span class="s1">&#39;/home/paul/data_song2/data_res/sigdra_obs/&#39;</span>
<span class="n">plot_dirs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">res_files</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">obs_file</span> <span class="ow">in</span> <span class="n">obs_files</span><span class="p">:</span>
    <span class="n">plot_dir_base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">obs_file</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">plot_dirs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plot_dir_parent</span><span class="p">,</span> <span class="n">plot_dir_base</span><span class="p">)]</span>
    
    <span class="n">res_files</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plot_dirs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;sigdra_res0.h5&#39;</span><span class="p">),</span> 
                      <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plot_dirs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;sigdra_res1.h5&#39;</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<p>And with that done, we can model the first observation to get an idea of what’s going on. For that, we use the function <code class="docutils literal notranslate"><span class="pre">model_single_observation</span></code>, and only hand in the first entry of all the created pathname arrays above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pyodine_model_observations</span><span class="o">.</span><span class="n">model_single_observation</span><span class="p">(</span>
    <span class="n">utilities</span><span class="p">,</span> <span class="n">Pars</span><span class="p">,</span> <span class="n">obs_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">temp_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
    <span class="n">plot_dir</span><span class="o">=</span><span class="n">plot_dirs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">res_names</span><span class="o">=</span><span class="n">res_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>---------------------------
/home/paul/data_song/data_ext/sigdra_obs_tutorial/s1_2015-04-20T03-01-01_ext.fits
Order correction: -1

Measured velocity rel. to reference spectrum: 27.260 km/s
Template velocity: 25.136 km/s
Velocity guess: 2.124 km/s (relative to template)

(Barycentric velocity of observation: -0.017 km/s)
(Barycentric velocity of template: 2.026 km/s)

Barycentric redshift between template and observation: 
v = 2042.7667999999999, z = 6.813936593428244e-06

Number of chunks:  528
In lowest order:  22
Orders:  17  -  40


----------------------
RUN 0
----------------------
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...

----------------------
RUN 1
----------------------
Fitted LSF parameters:
 &lt;ParameterSet (values: 10)&gt;
    left_1  =  7.952999660052042
    left_2  =  -8.812066508287234
    left_3  =  4.357821901357913
    left_4  =  -1.4911581250760837
    left_5  =  0.391047945429118
    right1  =  7.952993615981757
    right2  =  -8.812062245753744
    right3  =  4.357820779940487
    right4  =  -1.4911581405817538
    right5  =  0.39104801956544905
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...
Velocity robust mean: 2100.8666725134467
Velocity robust std: 199.36463640059335

Velocity error robust mean: 72.81863520233567
Velocity error robust std: 67.53793296761148

Minimum error: 18.248731996120657 in chunk 81
Maximum error: 284908.5034560086 in chunk 473

Chunks with nan velocities:  []
Chunks with nan velocity errors:  []
Velocity error at percentile 80: 185.69401709276661
Time to model this observation:  170.0567581653595
</pre></div>
</div>
</div>
</div>
<p>Great, let’s again have a look at the output:</p>
<ul class="simple">
<li><p>In the beginning, an ‘order correction’ of -1 is reported - this tells us that with regard to the observation that the deconvolved template was constructed from, the extracted Echelle orders seem to have shifted by one position.</p></li>
<li><p>Next, the velocity guess of the observation with respect to a reference spectrum (cross-correlation with Arcturus or Sun spectrum), along with the reference velocity of the stellar template, and the relative velocity between both - this serves as first guess of the model velocity <span class="math notranslate nohighlight">\(v\)</span>.</p></li>
<li><p>Also, the barycentric velocities of the observation and stellar template are printed (taken from the original <code class="docutils literal notranslate"><span class="pre">fits</span></code>-headers) - the difference between both is used to find the chunk positions in the observation spectrum.</p></li>
<li><p>The next print outputs are very much the same as in the <a class="reference internal" href="template.html"><span class="doc std std-doc">template creation routine</span></a>.</p></li>
<li><p>Finally, some information about the best-fit results for the chunk velocities (<span class="math notranslate nohighlight">\(v\)</span>) is given.</p></li>
</ul>
</div>
<div class="section" id="inspecting-the-fit-results-of-an-observation">
<h2>Inspecting the fit results of an observation<a class="headerlink" href="#inspecting-the-fit-results-of-an-observation" title="Permalink to this headline">¶</a></h2>
<p>Now let’s quickly take a look at the results of the second run (RUN 1) for this observation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Restore the RUN 1 fit results for the first observation</span>
<span class="n">chunks</span><span class="p">,</span> <span class="n">fit_results</span> <span class="o">=</span> <span class="n">pyodine</span><span class="o">.</span><span class="n">fitters</span><span class="o">.</span><span class="n">results_io</span><span class="o">.</span><span class="n">restore_results_object</span><span class="p">(</span>
    <span class="n">utilities</span><span class="p">,</span> <span class="n">res_files</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Order correction: -1

Barycentric redshift between template and observation: 
v = 2042.7667999999999, z = 6.813936593428244e-06

Total number of created chunks: 528 (in result file: 528)
Number of created chunks per order: 22
</pre></div>
</div>
</div>
</div>
<p>We again plot the data and best-fit model for one chunk - this time setting <code class="docutils literal notranslate"><span class="pre">template=True</span></code> in the function, to also display the stellar template data of that chunk:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Chunk index</span>
<span class="n">chunk_ind</span> <span class="o">=</span> <span class="mi">300</span>

<span class="n">pyodine</span><span class="o">.</span><span class="n">plot_lib</span><span class="o">.</span><span class="n">plot_chunkmodel</span><span class="p">(</span><span class="n">fit_results</span><span class="p">,</span> <span class="n">chunks</span><span class="p">,</span> <span class="n">chunk_ind</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                 <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/observation_17_0.png" src="../_images/observation_17_0.png" />
</div>
</div>
<p>Great, and let’s also check out the residuals of all chunks:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the histogram of residuals</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">pyodine</span><span class="o">.</span><span class="n">plot_lib</span><span class="o">.</span><span class="n">plot_residual_hist</span><span class="p">(</span><span class="n">fit_results</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Residuals histogram&#39;</span><span class="p">,</span> 
                                                <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Plot the scatter of residuals</span>
<span class="n">pyodine</span><span class="o">.</span><span class="n">plot_lib</span><span class="o">.</span><span class="n">plot_chunk_scatter</span><span class="p">(</span><span class="n">scatter</span><span class="o">=</span><span class="n">residuals</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Chunk residuals [%]&#39;</span><span class="p">,</span> 
                                    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Chunk residuals&#39;</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/observation_19_0.png" src="../_images/observation_19_0.png" />
<img alt="../_images/observation_19_1.png" src="../_images/observation_19_1.png" />
</div>
</div>
<p>Finally, it would be interesting to see the best-fit velocity results for all chunks, wouldn’t it?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">observation</span><span class="o">.</span><span class="n">time_start</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;2015-04-20T03:01:01.302&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fetch observation info</span>
<span class="n">star_name</span> <span class="o">=</span> <span class="n">chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">observation</span><span class="o">.</span><span class="n">star</span><span class="o">.</span><span class="n">name</span>
<span class="n">obs_date</span>  <span class="o">=</span> <span class="n">chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">observation</span><span class="o">.</span><span class="n">time_start</span><span class="o">.</span><span class="n">value</span>

<span class="c1"># Fetch the velocities and and their fit uncertainties</span>
<span class="n">velocities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;velocity&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">fit_results</span><span class="p">])</span>
<span class="n">vel_errors</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s1">&#39;velocity&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">fit_results</span><span class="p">]</span>

<span class="c1"># Compute robust mean and std</span>
<span class="n">vel_med</span> <span class="o">=</span> <span class="n">pyodine</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">robust_mean</span><span class="p">(</span><span class="n">velocities</span><span class="p">)</span>
<span class="n">vel_std</span> <span class="o">=</span> <span class="n">pyodine</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">robust_std</span><span class="p">(</span><span class="n">velocities</span><span class="p">)</span>

<span class="c1"># And plot (in constraint y-range)</span>
<span class="n">pyodine</span><span class="o">.</span><span class="n">plot_lib</span><span class="o">.</span><span class="n">plot_chunk_scatter</span><span class="p">(</span>
    <span class="n">errorbar</span><span class="o">=</span><span class="n">velocities</span><span class="p">,</span> <span class="n">errorbar_yerr</span><span class="o">=</span><span class="n">vel_errors</span><span class="p">,</span> <span class="n">errorbar_alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> 
    <span class="n">errorbar_label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{:.1f}</span><span class="s1">+-</span><span class="si">{:.1f}</span><span class="s1"> m/s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vel_med</span><span class="p">,</span> <span class="n">vel_std</span><span class="p">),</span>
    <span class="n">yrange</span><span class="o">=</span><span class="p">(</span><span class="n">vel_med</span><span class="o">-</span><span class="mi">5</span><span class="o">*</span><span class="n">vel_std</span><span class="p">,</span> <span class="n">vel_med</span><span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="n">vel_std</span><span class="p">),</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Velocity [m/s]&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">, velocities&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">star_name</span><span class="p">,</span> <span class="n">obs_date</span><span class="p">),</span> 
    <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/observation_22_0.png" src="../_images/observation_22_0.png" />
</div>
</div>
<p>There is quite some scatter and large uncertainties at high chunk indices, i.e. red wavelengths, and also a linear trend throughout the chunks is apparent. Nevertheless, we will be able to generate quite good RVs out of these results, as you will see <a class="reference internal" href="velocities.html"><span class="doc std std-doc">in the next chapter</span></a>.</p>
</div>
<div class="section" id="run-the-code-on-many-observations">
<h2>Run the code on many observations<a class="headerlink" href="#run-the-code-on-many-observations" title="Permalink to this headline">¶</a></h2>
<p>We have seen now how to model a single observation, and what the results look like. For a timeseries however we need multiple observations, and to model these you can use the function <code class="docutils literal notranslate"><span class="pre">model_multi_observations</span></code> - it parallelizes the tasks to accelerate the whole procedure. With the attribute <code class="docutils literal notranslate"><span class="pre">number_cores</span></code> of your parameter object <code class="docutils literal notranslate"><span class="pre">Pars</span></code> you can control how many separate processes are created - right now it is set to 4, but better check your computing power before you run the code!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pyodine_model_observations</span><span class="o">.</span><span class="n">model_multi_observations</span><span class="p">(</span>
    <span class="n">utilities</span><span class="p">,</span> <span class="n">Pars</span><span class="p">,</span> <span class="n">obs_files</span><span class="p">,</span> <span class="n">temp_files</span><span class="p">,</span> 
    <span class="n">plot_dirs</span><span class="o">=</span><span class="n">plot_dirs</span><span class="p">,</span> <span class="n">res_files</span><span class="o">=</span><span class="n">res_files</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>---------------------------
/home/paul/data_song/data_ext/sigdra_obs_tutorial/s1_2015-04-20T03-01-01_ext.fits

---------------------------
/home/paul/data_song/data_ext/sigdra_obs_tutorial/s1_2015-04-20T03-07-04_ext.fits

---------------------------
/home/paul/data_song/data_ext/sigdra_obs_tutorial/s1_2015-04-20T03-13-07_ext.fits

---------------------------
/home/paul/data_song/data_ext/sigdra_obs_tutorial/s1_2015-04-22T04-31-04_ext.fits
Order correction: -1

Order correction: -1

Order correction: -1

Order correction: -1

Measured velocity rel. to reference spectrum: 27.260 km/s
Template velocity: 25.136 km/s
Velocity guess: 2.124 km/s (relative to template)

(Barycentric velocity of observation: -0.017 km/s)
(Barycentric velocity of template: 2.026 km/s)

Barycentric redshift between template and observation: 
v = 2042.7667999999999, z = 6.813936593428244e-06

Number of chunks:  528
In lowest order:  22
Orders: Measured velocity rel. to reference spectrum: 27.208 km/s
Template velocity: 25.136 km/s
Velocity guess: 2.072 km/s (relative to template)

 (Barycentric velocity of observation: -0.019 km/s)
17(Barycentric velocity of template: 2.026 km/s)

 Barycentric redshift between template and observation: 
v = 2044.5937999999999, z = 6.820030809447514e-06

 -  40


----------------------
RUN 0
----------------------
Number of chunks:  Measured velocity rel. to reference spectrum: 27.202 km/s528

In lowest order: Template velocity: 25.136 km/s
 22
Orders:  Velocity guess: 2.066 km/s (relative to template)

(Barycentric velocity of observation: -0.021 km/s)17  -  40


(Barycentric velocity of template: 2.026 km/s)

----------------------
Barycentric redshift between template and observation: 

RUN 0v = 2046.5000999999997, z = 6.826389541794276e-06

----------------------

Number of chunks:  528
In lowest order:  22
Orders:  17  -  40


----------------------
RUN 0
----------------------Measured velocity rel. to reference spectrum: 27.311 km/s

Template velocity: 25.136 km/s
Velocity guess: 2.174 km/s (relative to template)

(Barycentric velocity of observation: 0.104 km/s)
(Barycentric velocity of template: 2.026 km/s)

Barycentric redshift between template and observation: 
v = 1921.1191, z = 6.408163543593881e-06

Number of chunks:  528
In lowest order:  22
Orders:  17  -  40


----------------------
RUN 0
----------------------
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...
Creating analysis plots...
Creating analysis plots...
Creating analysis plots...

----------------------
RUN 1
----------------------

----------------------
RUN 1
----------------------

----------------------
RUN 1
----------------------

----------------------
RUN 1
----------------------
Fitted LSF parameters:
 &lt;ParameterSet (values: 10)&gt;
    left_1  =  8.005461803369819
    left_2  =  -8.842208186472336
    left_3  =  4.369049109471312
    left_4  =  -1.4948637685558328
    left_5  =  0.3921666518035927
    right1  =  8.005458796483321
    right2  =  -8.842206209479235
    right3  =  4.36904873492262
    right4  =  -1.4948639272519884
    right5  =  0.3921667539566389
Fitted LSF parameters:
 &lt;ParameterSet (values: 10)&gt;
    left_1  =  8.12569729999735
    left_2  =  -8.908975141361404
    left_3  =  4.394336325367605
    left_4  =  -1.5034370478714385
    left_5  =  0.3948158226921298
    right1  =  8.12568792631719
    right2  =  -8.90896851325473
    right3  =  4.394334373388575
    right4  =  -1.5034368895090913
    right5  =  0.394815863973859
Fitted LSF parameters:
 &lt;ParameterSet (values: 10)&gt;
    left_1  =  7.952999660052042
    left_2  =  -8.812066508287234
    left_3  =  4.357821901357913
    left_4  =  -1.4911581250760837
    left_5  =  0.391047945429118
    right1  =  7.952993615981757
    right2  =  -8.812062245753744
    right3  =  4.357820779940487
    right4  =  -1.4911581405817538
    right5  =  0.39104801956544905
Fitted LSF parameters:
 &lt;ParameterSet (values: 10)&gt;
    left_1  =  8.840342570181647
    left_2  =  -8.921104162179152
    left_3  =  4.367622539035587
    left_4  =  -1.50275912079006
    left_5  =  0.4072150957703115
    right1  =  8.840329978936975
    right2  =  -8.921095831702125
    right3  =  4.367618433805855
    right4  =  -1.5027577269140833
    right5  =  0.4072147168458073
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Velocity robust mean: 1980.605744281596
Velocity robust std: 197.28484578633567

Velocity error robust mean: 74.36439723038305
Velocity error robust std: 62.17112035957051

Minimum error: 24.441468809560366 in chunk 81
Maximum error: 2174.9995306880774 in chunk 400

Chunks with nan velocities:  []
Chunks with nan velocity errors:  []
Velocity error at percentile 80: 185.54859497072636
Creating analysis plots...
Time to model this observation:  268.97669076919556

---------------------------
/home/paul/data_song/data_ext/sigdra_obs_tutorial/s1_2015-04-22T04-37-07_ext.fits
Order correction: -1

Measured velocity rel. to reference spectrum: 27.342 km/s
Template velocity: 25.136 km/s
Velocity guess: 2.206 km/s (relative to template)

(Barycentric velocity of observation: 0.102 km/s)
(Barycentric velocity of template: 2.026 km/s)

Barycentric redshift between template and observation: 
v = 1924.0323999999998, z = 6.417881266379289e-06

Number of chunks:  528
In lowest order:  22
Orders:  17  -  40


----------------------
RUN 0
----------------------
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...
Velocity robust mean: 2114.0658717669066
Velocity robust std: 209.70757596876823

Velocity error robust mean: 70.34113686723641
Velocity error robust std: 66.0742628828204

Minimum error: 19.041840933081193 in chunk 81
Maximum error: 4679.303714047238 in chunk 473

Chunks with nan velocities:  []
Chunks with nan velocity errors:  []
Velocity error at percentile 80: 188.305613665041
Time to model this observation:  282.08831906318665

---------------------------
/home/paul/data_song/data_ext/sigdra_obs_tutorial/s1_2015-04-22T04-43-10_ext.fits
Order correction: -1

Measured velocity rel. to reference spectrum: 27.338 km/s
Template velocity: 25.136 km/s
Velocity guess: 2.202 km/s (relative to template)

(Barycentric velocity of observation: 0.099 km/s)
(Barycentric velocity of template: 2.026 km/s)

Barycentric redshift between template and observation: 
v = 1926.9929999999997, z = 6.4277567649817256e-06

Number of chunks:  528
In lowest order:  22
Orders:  17  -  40


----------------------
RUN 0
----------------------
Velocity robust mean: 2105.9401426213244
Velocity robust std: 200.37714415075098

Velocity error robust mean: 73.6074672368713
Velocity error robust std: 64.807452174591

Minimum error: 22.071189735066948 in chunk 54
Maximum error: 3908.7089056356253 in chunk 473

Chunks with nan velocities:  []
Chunks with nan velocity errors:  []
Velocity error at percentile 80: 189.75547306353928
Time to model this observation:  293.3444938659668

---------------------------
/home/paul/data_song/data_ext/sigdra_obs_tutorial/s1_2015-04-23T05-01-07_ext.fits
Order correction: -1

Measured velocity rel. to reference spectrum: 27.177 km/s
Template velocity: 25.136 km/s
Velocity guess: 2.041 km/s (relative to template)

(Barycentric velocity of observation: 0.167 km/s)
(Barycentric velocity of template: 2.026 km/s)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Barycentric redshift between template and observation: 
v = 1858.2756999999997, z = 6.1985405249921255e-06

Number of chunks:  528
In lowest order:  22
Orders:  17  -  40


----------------------
RUN 0
----------------------
Velocity robust mean: 2100.8666725134467
Velocity robust std: 199.36463640059335

Velocity error robust mean: 72.81863520233567
Velocity error robust std: 67.53793296761148

Minimum error: 18.248731996120657 in chunk 81
Maximum error: 284908.5034560086 in chunk 473

Chunks with nan velocities:  []
Chunks with nan velocity errors:  []
Velocity error at percentile 80: 185.69401709276661
Time to model this observation:  303.44336104393005

---------------------------
/home/paul/data_song/data_ext/sigdra_obs_tutorial/s1_2015-04-23T05-07-10_ext.fits
Order correction: -1

Measured velocity rel. to reference spectrum: 27.215 km/s
Template velocity: 25.136 km/s
Velocity guess: 2.078 km/s (relative to template)

(Barycentric velocity of observation: 0.164 km/s)
(Barycentric velocity of template: 2.026 km/s)

Barycentric redshift between template and observation: 
v = 1861.4337999999998, z = 6.209074812682578e-06

Number of chunks:  528
In lowest order:  22
Orders:  17  -  40


----------------------
RUN 0
----------------------
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...

----------------------
RUN 1
----------------------
Fitted LSF parameters:
 &lt;ParameterSet (values: 10)&gt;
    left_1  =  8.838734769866136
    left_2  =  -8.920957855626188
    left_3  =  4.36742235845423
    left_4  =  -1.5027143738010285
    left_5  =  0.40720357015269343
    right1  =  8.83873266861459
    right2  =  -8.920956485871859
    right3  =  4.367421687288989
    right4  =  -1.5027141420275476
    right5  =  0.40720350504960984
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...

----------------------
RUN 1
----------------------
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Fitted LSF parameters:
 &lt;ParameterSet (values: 10)&gt;
    left_1  =  8.82216830984469
    left_2  =  -8.919634798531504
    left_3  =  4.365521471621463
    left_4  =  -1.5023252028626055
    left_5  =  0.4071083383653532
    right1  =  8.822155141741709
    right2  =  -8.919627855895433
    right3  =  4.365519046100027
    right4  =  -1.502324906147587
    right5  =  0.4071083565407716
Creating analysis plots...

----------------------
RUN 1
----------------------
Fitted LSF parameters:
 &lt;ParameterSet (values: 10)&gt;
    left_1  =  8.708383518004318
    left_2  =  -8.906051844068077
    left_3  =  4.3527669877581285
    left_4  =  -1.4995065536480874
    left_5  =  0.4064212597006704
    right1  =  8.708385322667652
    right2  =  -8.906052848026137
    right3  =  4.352767309725277
    right4  =  -1.4995065729899604
    right5  =  0.40642124600667023

----------------------
RUN 1
----------------------
Fitted LSF parameters:
 &lt;ParameterSet (values: 10)&gt;
    left_1  =  8.70168229395422
    left_2  =  -8.905024116721638
    left_3  =  4.352028091860546
    left_4  =  -1.4993341575622712
    left_5  =  0.4063793141943309
    right1  =  8.701674342498356
    right2  =  -8.905020799293805
    right3  =  4.3520278053482215
    right4  =  -1.4993347457206385
    right5  =  0.40637960737190215
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...
Creating analysis plots...
Velocity robust mean: 1986.7512160560864
Velocity robust std: 210.86168521981543

Velocity error robust mean: 74.26726513704727
Velocity error robust std: 63.09301708916692

Minimum error: 20.579141134136187 in chunk 53
Maximum error: 7347.184211400373 in chunk 477

Chunks with nan velocities:  []
Chunks with nan velocity errors:  []
Velocity error at percentile 80: 192.26733645701165
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Time to model this observation:  275.0611708164215

---------------------------
/home/paul/data_song/data_ext/sigdra_obs_tutorial/s1_2015-04-23T05-13-12_ext.fits
Order correction: -1

Creating analysis plots...
Measured velocity rel. to reference spectrum: 27.167 km/s
Template velocity: 25.136 km/s
Velocity guess: 2.031 km/s (relative to template)

(Barycentric velocity of observation: 0.161 km/s)
(Barycentric velocity of template: 2.026 km/s)

Barycentric redshift between template and observation: 
v = 1864.6278999999997, z = 6.2197291834473024e-06

Number of chunks:  528
In lowest order:  22
Orders:  17  -  40


----------------------
RUN 0
----------------------
Velocity robust mean: 1985.8976435246107
Velocity robust std: 207.63326536250207

Velocity error robust mean: 74.16562065941797
Velocity error robust std: 63.50663658219112

Minimum error: 24.80857554143 in chunk 253
Maximum error: 4177.207355444456 in chunk 400

Chunks with nan velocities:  []
Chunks with nan velocity errors:  []
Velocity robust mean: 1918.991902290118
Velocity robust std: 209.42562485663365

Velocity error robust mean: 70.92718804175247
Velocity error robust std: 61.165539987521726

Minimum error: 23.652948549043373 in chunk 54
Maximum error: 2530.976791218838 in chunk 473

Chunks with nan velocities:  []
Chunks with nan velocity errors:  []
Velocity error at percentile 80: 187.22506316319152
Velocity error at percentile 80: 183.2684704491224
Time to model this observation:  280.389878988266

---------------------------
/home/paul/data_song/data_ext/sigdra_obs_tutorial/s1_2015-04-24T04-21-04_ext.fits
Time to model this observation:  269.9290738105774

---------------------------
/home/paul/data_song/data_ext/sigdra_obs_tutorial/s1_2015-04-24T04-27-07_ext.fits
Order correction: -1

Measured velocity rel. to reference spectrum: 27.008 km/s
Template velocity: 25.136 km/s
Velocity guess: 1.872 km/s (relative to template)

(Barycentric velocity of observation: 0.265 km/s)
(Barycentric velocity of template: 2.026 km/s)

Barycentric redshift between template and observation: 
v = 1760.6891999999998, z = 5.873026999231581e-06

Number of chunks:  528
In lowest order:  22
Orders:  17  -  40


----------------------
RUN 0
----------------------
Order correction: -1

Measured velocity rel. to reference spectrum: 27.070 km/s
Template velocity: 25.136 km/s
Velocity guess: 1.934 km/s (relative to template)

(Barycentric velocity of observation: 0.262 km/s)
(Barycentric velocity of template: 2.026 km/s)

Barycentric redshift between template and observation: 
v = 1763.5863999999997, z = 5.882691018197662e-06

Number of chunks:  528
In lowest order:  22
Orders:  17  -  40


----------------------
RUN 0
----------------------
Velocity robust mean: 1929.8173164322604
Velocity robust std: 220.3116677826936

Velocity error robust mean: 71.47415644923514
Velocity error robust std: 61.34376066995702

Minimum error: 22.108493781596408 in chunk 54
Maximum error: 7152.924951882587 in chunk 473

Chunks with nan velocities:  []
Chunks with nan velocity errors:  []
Velocity error at percentile 80: 178.8849683949794
Time to model this observation:  270.33621287345886

---------------------------
/home/paul/data_song/data_ext/sigdra_obs_tutorial/s1_2015-04-24T04-33-10_ext.fits
Order correction: -1

Measured velocity rel. to reference spectrum: 27.057 km/s
Template velocity: 25.136 km/s
Velocity guess: 1.921 km/s (relative to template)

(Barycentric velocity of observation: 0.259 km/s)
(Barycentric velocity of template: 2.026 km/s)

Barycentric redshift between template and observation: 
v = 1766.5313999999998, z = 5.892514480801247e-06

Number of chunks:  528
In lowest order:  22
Orders:  17  -  40


----------------------
RUN 0
----------------------
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...

----------------------
RUN 1
----------------------
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Fitted LSF parameters:
 &lt;ParameterSet (values: 10)&gt;
    left_1  =  8.685563550778621
    left_2  =  -8.902458244024253
    left_3  =  4.350261247875076
    left_4  =  -1.4989217352603124
    left_5  =  0.40627962347622404
    right1  =  8.68556007436158
    right2  =  -8.902457318129734
    right3  =  4.35026167380149
    right4  =  -1.498922323523738
    right5  =  0.4062798666363492
Creating analysis plots...
Creating analysis plots...
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...

----------------------
RUN 1
----------------------

----------------------
RUN 1
----------------------
Fitted LSF parameters:
 &lt;ParameterSet (values: 10)&gt;
    left_1  =  8.936020978345017
    left_2  =  -8.925420699572463
    left_3  =  4.379137716412336
    left_4  =  -1.504938379151953
    left_5  =  0.4077571415967053
    right1  =  8.936007282244985
    right2  =  -8.925412971586592
    right3  =  4.379134284468824
    right4  =  -1.50493752006764
    right5  =  0.4077569648446829
Fitted LSF parameters:
 &lt;ParameterSet (values: 10)&gt;
    left_1  =  8.862013459198069
    left_2  =  -8.922568766572844
    left_3  =  4.37014664339634
    left_4  =  -1.5032628937919428
    left_5  =  0.4073389717864911
    right1  =  8.86201967686876
    right2  =  -8.922574172855313
    right3  =  4.370150018378221
    right4  =  -1.5032644207669554
    right5  =  0.40733945849361347

----------------------
RUN 1
----------------------
Fitted LSF parameters:
 &lt;ParameterSet (values: 10)&gt;
    left_1  =  8.854411017936005
    left_2  =  -8.922095105044205
    left_3  =  4.369260923727088
    left_4  =  -1.5030891450470916
    left_5  =  0.40729637172079197
    right1  =  8.85440514622647
    right2  =  -8.9220912853405
    right3  =  4.369259005175519
    right4  =  -1.503088441996331
    right5  =  0.40729616244024736
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...
Velocity robust mean: 1930.578663796998
Velocity robust std: 212.0268319132885

Velocity error robust mean: 72.67800176258126
Velocity error robust std: 61.54533079502134

Minimum error: 21.718740832030935 in chunk 81
Maximum error: 5467.958034890414 in chunk 473

Chunks with nan velocities:  []
Chunks with nan velocity errors:  []
Velocity error at percentile 80: 177.880320478996
Time to model this observation:  261.6808021068573

---------------------------
/home/paul/data_song/data_ext/sigdra_obs_tutorial/s1_2015-04-25T04-01-03_ext.fits
Order correction: -1

Measured velocity rel. to reference spectrum: 27.159 km/s
Template velocity: 25.136 km/s
Velocity guess: 2.023 km/s (relative to template)

(Barycentric velocity of observation: 0.352 km/s)
(Barycentric velocity of template: 2.026 km/s)

Barycentric redshift between template and observation: 
v = 1673.8397999999997, z = 5.583328583936557e-06

Number of chunks:  528
In lowest order:  22
Orders:  17  -  40


----------------------
RUN 0
----------------------
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...
Number of chunks with no uncertainties:  1
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...
Velocity robust mean: 1822.2326711541252
Velocity robust std: 217.04486753125315

Velocity error robust mean: 79.76667724979235
Velocity error robust std: 67.26517035481262

Minimum error: 25.801159739684387 in chunk 253
Maximum error: 3223.8316922457043 in chunk 400

Chunks with nan velocities:  []
Chunks with nan velocity errors:  []
Velocity error at percentile 80: 194.71309793746164
Velocity robust mean: 1824.1200414932362
Velocity robust std: 218.6010113344298

Velocity error robust mean: 83.36301020468854
Velocity error robust std: 67.13213997025775

Minimum error: 26.384673850057176 in chunk 253
Maximum error: 31527.991201941695 in chunk 473

Chunks with nan velocities:  []
Chunks with nan velocity errors:  [381]
Velocity error at percentile 80: 194.57379616405225
Time to model this observation:  275.9794042110443

---------------------------
/home/paul/data_song/data_ext/sigdra_obs_tutorial/s1_2015-04-25T04-07-06_ext.fits
Order correction: -1

Measured velocity rel. to reference spectrum: 27.194 km/s
Template velocity: 25.136 km/s
Velocity guess: 2.058 km/s (relative to template)

(Barycentric velocity of observation: 0.349 km/s)
(Barycentric velocity of template: 2.026 km/s)

Barycentric redshift between template and observation: 
v = 1676.5930999999998, z = 5.592512604169648e-06

Number of chunks:  528
In lowest order:  22
Orders:  17  -  40


----------------------
RUN 0
----------------------
Time to model this observation:  280.03664898872375

---------------------------
/home/paul/data_song/data_ext/sigdra_obs_tutorial/s1_2015-04-25T04-13-09_ext.fits
Order correction: -1

Measured velocity rel. to reference spectrum: 27.152 km/s
Template velocity: 25.136 km/s
Velocity guess: 2.016 km/s (relative to template)

(Barycentric velocity of observation: 0.346 km/s)
(Barycentric velocity of template: 2.026 km/s)

Barycentric redshift between template and observation: 
v = 1679.4008, z = 5.601878083270527e-06

Number of chunks:  528
In lowest order:  22
Orders:  17  -  40


----------------------
RUN 0
----------------------
Velocity robust mean: 1830.1709122060715
Velocity robust std: 227.3905957376948

Velocity error robust mean: 81.23958983565332
Velocity error robust std: 65.92719929239935

Minimum error: 22.317660753580707 in chunk 54
Maximum error: 78119.80699419987 in chunk 469

Chunks with nan velocities:  []
Chunks with nan velocity errors:  []
Velocity error at percentile 80: 194.38970359845945
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Time to model this observation:  282.5030035972595

---------------------------
/home/paul/data_song/data_ext/sigdra_obs_tutorial/s1_2015-04-26T03-01-02_ext.fits
Creating analysis plots...
Order correction: -1

Measured velocity rel. to reference spectrum: 26.947 km/s
Template velocity: 25.136 km/s
Velocity guess: 1.811 km/s (relative to template)

(Barycentric velocity of observation: 0.453 km/s)
(Barycentric velocity of template: 2.026 km/s)

Barycentric redshift between template and observation: 
v = 1572.1482999999998, z = 5.244122252068129e-06

Number of chunks:  528
In lowest order:  22
Orders:  17  -  40


----------------------
RUN 0
----------------------

----------------------
RUN 1
----------------------
Fitted LSF parameters:
 &lt;ParameterSet (values: 10)&gt;
    left_1  =  8.746352717747474
    left_2  =  -8.911410614769117
    left_3  =  4.356969356482662
    left_4  =  -1.5004678926073043
    left_5  =  0.40665479685041345
    right1  =  8.746346781960007
    right2  =  -8.911406959450542
    right3  =  4.356967843773466
    right4  =  -1.500467514826839
    right5  =  0.4066547222798039
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Creating analysis plots...
Creating analysis plots...
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0

----------------------
RUN 1
----------------------
Creating analysis plots...
Fitted LSF parameters:
 &lt;ParameterSet (values: 10)&gt;
    left_1  =  8.685791051923717
    left_2  =  -8.90250451051757
    left_3  =  4.350290520074771
    left_4  =  -1.498929420280598
    left_5  =  0.40628158566294625
    right1  =  8.685770493175287
    right2  =  -8.902493410204523
    right3  =  4.3502871738456825
    right4  =  -1.4989292741297797
    right5  =  0.40628173499503933

----------------------
RUN 1
----------------------
Fitted LSF parameters:
 &lt;ParameterSet (values: 10)&gt;
    left_1  =  8.809059189963497
    left_2  =  -8.91846479916494
    left_3  =  4.364028789839978
    left_4  =  -1.5020139997317525
    left_5  =  0.40703241646133514
    right1  =  8.809059595837896
    right2  =  -8.918465356358931
    right3  =  4.364029269959266
    right4  =  -1.5020143127175558
    right5  =  0.40703253792494887

----------------------
RUN 1
----------------------
Fitted LSF parameters:
 &lt;ParameterSet (values: 10)&gt;
    left_1  =  8.814999465115886
    left_2  =  -8.919000733526811
    left_3  =  4.364699238848746
    left_4  =  -1.5021529440449952
    left_5  =  0.407066074711484
    right1  =  8.81498547417736
    right2  =  -8.918992076018007
    right3  =  4.364695344959396
    right4  =  -1.502151779604208
    right5  =  0.40706578233525653
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...
Velocity robust mean: 1734.3599821008534
Velocity robust std: 210.91058823909563

Velocity error robust mean: 76.73106543704795
Velocity error robust std: 65.17700941233032

Minimum error: 22.52868544760979 in chunk 58
Maximum error: 3327.4189766140457 in chunk 473

Chunks with nan velocities:  []
Chunks with nan velocity errors:  []
Velocity error at percentile 80: 190.31084832785274
Time to model this observation:  302.41432189941406

---------------------------
/home/paul/data_song/data_ext/sigdra_obs_tutorial/s1_2015-04-26T03-07-05_ext.fits
Order correction: -1

Measured velocity rel. to reference spectrum: 26.962 km/s
Template velocity: 25.136 km/s
Velocity guess: 1.826 km/s (relative to template)

(Barycentric velocity of observation: 0.451 km/s)
(Barycentric velocity of template: 2.026 km/s)

Barycentric redshift between template and observation: 
v = 1574.2857, z = 5.251251851038894e-06

Number of chunks:  528
In lowest order:  22
Orders:  17  -  40


----------------------
RUN 0
----------------------
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...
Velocity robust mean: 1739.4196967779562
Velocity robust std: 213.40543375903238

Velocity error robust mean: 75.20283282639801
Velocity error robust std: 64.96750164623052

Minimum error: 22.92619361534288 in chunk 119
Maximum error: 2710.469618035871 in chunk 437

Chunks with nan velocities:  []
Chunks with nan velocity errors:  []
Velocity error at percentile 80: 190.12184033004928
Time to model this observation:  306.781405210495

---------------------------
/home/paul/data_song/data_ext/sigdra_obs_tutorial/s1_2015-04-26T03-13-08_ext.fits
Order correction: -1

Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Measured velocity rel. to reference spectrum: 26.944 km/s
Template velocity: 25.136 km/s
Velocity guess: 1.807 km/s (relative to template)

(Barycentric velocity of observation: 0.449 km/s)
(Barycentric velocity of template: 2.026 km/s)

Barycentric redshift between template and observation: 
v = 1576.4962999999998, z = 5.258625618927344e-06

Number of chunks:  528
In lowest order:  22
Orders:  17  -  40


----------------------
RUN 0
----------------------
Velocity robust mean: 1736.4336797330827
Velocity robust std: 213.4224494899295

Velocity error robust mean: 79.10156967780502
Velocity error robust std: 67.49750514245262

Minimum error: 24.523778135765767 in chunk 119
Maximum error: 113731.61712031697 in chunk 437

Chunks with nan velocities:  []
Chunks with nan velocity errors:  []
Velocity error at percentile 80: 191.08891881425652
Creating analysis plots...
Time to model this observation:  311.27583956718445

---------------------------
/home/paul/data_song/data_ext/sigdra_obs_tutorial/s1_2015-04-27T04-38-23_ext.fits
Order correction: -1

Measured velocity rel. to reference spectrum: 27.256 km/s
Template velocity: 25.136 km/s
Velocity guess: 2.120 km/s (relative to template)

(Barycentric velocity of observation: 0.488 km/s)
(Barycentric velocity of template: 2.026 km/s)

Barycentric redshift between template and observation: 
v = 1537.4899999999998, z = 5.128514607262067e-06

Number of chunks:  528
In lowest order:  22
Orders:  17  -  40


----------------------
RUN 0
----------------------
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...
Velocity robust mean: 1621.6504308567116
Velocity robust std: 212.6307193748783

Velocity error robust mean: 78.49667062447035
Velocity error robust std: 68.08192534358834

Minimum error: 19.13588502036074 in chunk 81
Maximum error: 3369.8798167332284 in chunk 400

Chunks with nan velocities:  []
Chunks with nan velocity errors:  []
Velocity error at percentile 80: 194.67214578994597
Time to model this observation:  326.1876256465912

---------------------------
/home/paul/data_song/data_ext/sigdra_obs_tutorial/s1_2015-04-27T04-44-26_ext.fits
Order correction: -1


----------------------
RUN 1
----------------------
Measured velocity rel. to reference spectrum: 27.302 km/s
Template velocity: 25.136 km/s
Velocity guess: 2.166 km/s (relative to template)

(Barycentric velocity of observation: 0.485 km/s)
(Barycentric velocity of template: 2.026 km/s)

Barycentric redshift between template and observation: 
v = 1540.6071999999997, z = 5.138912467237584e-06

Number of chunks:  528
In lowest order:  22
Orders:  17  -  40


----------------------
RUN 0
----------------------
Fitted LSF parameters:
 &lt;ParameterSet (values: 10)&gt;
    left_1  =  8.780783175577474
    left_2  =  -8.915565655848608
    left_3  =  4.360821249568267
    left_4  =  -1.5013226144836391
    left_5  =  0.4068630829692995
    right1  =  8.780766428144423
    right2  =  -8.915555874496736
    right3  =  4.360817312416153
    right4  =  -1.5013216637153322
    right5  =  0.4068628895277139
Number of chunks with no uncertainties:  1
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...

----------------------
RUN 1
----------------------
Fitted LSF parameters:
 &lt;ParameterSet (values: 10)&gt;
    left_1  =  8.785093283235897
    left_2  =  -8.91604662492548
    left_3  =  4.361312881250771
    left_4  =  -1.501431519164006
    left_5  =  0.40688997124360266
    right1  =  8.785078712935752
    right2  =  -8.916038091139013
    right3  =  4.361309468783288
    right4  =  -1.5014307466243275
    right5  =  0.4068898340300646

----------------------
RUN 1
----------------------
Fitted LSF parameters:
 &lt;ParameterSet (values: 10)&gt;
    left_1  =  7.893177362564948
    left_2  =  -8.982690782863124
    left_3  =  4.5136954338343935
    left_4  =  -1.5540926418006311
    left_5  =  0.40165059598925423
    right1  =  7.893163093662705
    right2  =  -8.982677920351037
    right3  =  4.513689904774943
    right4  =  -1.554090846951326
    right5  =  0.40165007923750334
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...

----------------------
RUN 1
----------------------
Fitted LSF parameters:
 &lt;ParameterSet (values: 10)&gt;
    left_1  =  5.18240957739959
    left_2  =  -7.108178564981885
    left_3  =  4.111716981907693
    left_4  =  -1.5347383456142105
    left_5  =  0.3719444845565083
    right1  =  5.182397604141514
    right2  =  -7.108161525254743
    right3  =  4.111706165311735
    right4  =  -1.5347333990662244
    right5  =  0.37194292177822963
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...
Velocity robust mean: 1632.7574827421797
Velocity robust std: 204.6519728723176

Velocity error robust mean: 77.5403999623451
Velocity error robust std: 66.68171754422396

Minimum error: 25.422188354023536 in chunk 81
Maximum error: 28545.71860702296 in chunk 437

Chunks with nan velocities:  []
Chunks with nan velocity errors:  []
Velocity error at percentile 80: 198.7414664849114
Time to model this observation:  342.93796157836914
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...
Creating analysis plots...
Velocity robust mean: 1602.6550671513673
Velocity robust std: 209.9818296206532

Velocity error robust mean: 70.81227160051536
Velocity error robust std: 62.868616881257445

Minimum error: 16.925782737951042 in chunk 81
Maximum error: 6644.845040109092 in chunk 437

Chunks with nan velocities:  []
Chunks with nan velocity errors:  []
Velocity robust mean: 1630.8589246064873
Velocity robust std: 217.7410821488936

Velocity error robust mean: 82.06477883136182
Velocity error robust std: 71.51096439345422

Minimum error: 26.33222150426935 in chunk 53
Maximum error: 1659.82267752005 in chunk 467

Chunks with nan velocities:  []
Chunks with nan velocity errors:  []
Velocity error at percentile 80: 175.82838757174525
Velocity error at percentile 80: 196.2665790403595
Time to model this observation:  341.66567754745483
Time to model this observation:  350.14520025253296
Number of chunks with no uncertainties:  0
Number of chunks with outliers:  0
Number of chunks with nan fitted red. Chi2:  0
Creating analysis plots...
Velocity robust mean: 1597.8872658865926
Velocity robust std: 201.4595340841589

Velocity error robust mean: 70.70969167079566
Velocity error robust std: 59.0383558113675

Minimum error: 22.399687320515817 in chunk 76
Maximum error: 4422.761462708121 in chunk 437

Chunks with nan velocities:  []
Chunks with nan velocity errors:  []
Velocity error at percentile 80: 176.82327326278255
Time to model this observation:  352.86973118782043

Done, full working time:  1535.8628900051117
</pre></div>
</div>
</div>
</div>
</div>
</div>


              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="template.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Create a deconvolved stellar template</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="velocities.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Weight and combine the chunk velocities</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Heeren, Tronsgaard Rasmussen, Grundahl<br/>
        
            &copy; Copyright 2021, Heeren, Tronsgaard Rasmussen, Grundahl.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>